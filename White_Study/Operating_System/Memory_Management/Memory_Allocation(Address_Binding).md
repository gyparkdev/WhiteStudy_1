# Memory Allocation(Address Binding)

---

![Untitled](Memory_Allocation(Address_Binding)/Untitled.png)

# 정의

- 메모리 할당은 컴퓨터 프로그램과 서비스에 물리적 또는 가상 메모리 공간을 할당하는 프로세스다.
- 컴퓨터의 주 기억장치인 RAM에서 이루어진다.
- 프로그램 및 프로세스 실행을 위해 컴퓨터 메모리의 일부 또는 전체를 예약하는 프로세스이다.
- 스택 영역은 프로그램의 지역 변수를 저장하는 역할을 한다. 메인을 포함하여 함수 시작 시 변수와 배열은 스택 공간에 위치한다. 스택은 높은 주소에서 낮은 주소로 증가한다.
- 반면에 힙 영역은 동적 메모리 할당을 담당한다. 스택과 달리 힙은 낮은 주소에서 높은 주소로 증가한다. 그런데 힙 영역은 힙 데이터 구조와 공통적으로 관련이 없다는 점을 명심하는 것이 중요하다. **명령어가 코드 공간에 있는 동안 전역 및 정적 변수는 정적/전역 부분에 들어간다.**
- 메모리 할당은 실행 전이나 실행 시에 수행되며, 다음의 두 가지 유형이 있다.
    - 컴파일 시간 혹은 정적 메모리 할당
    - 런타임 혹은 동적 메모리 할당
- 정적, 동적 메모리 할당 모두 사용 가능한 메모리 위치와 사용 중인 메모리 위치를 나타내는 각 메모리 위치 블록을 유지해야 한다. 그 뒤 새 작업이 시스템에 들어오면 여유 파티션을 할당하는데, 이 때 사용하는 전략은 다음과 같다.
- Fit 전략
    - Worst Fit
        - 프로세스가 전체 메모리를 순회하며 항상 가장 큰 파티션/구멍을 검색한 뒤 해당 파티션/구멍에 프로세스를 배치한다.
        - 가장 느린 프로세스다.
    - First Fit
        - OS는 프로세스의 메모리 요청을 수용할 수 있을 만큼 큰 블록을 찾을 때까지 목록의 처음부터 시작하여 가능한 메모리 블록 목록을 검색한다.
        - 적합한 블록을 찾으면 OS는 블록을 할당 부분과 여유 블록으로 나눈다.
    - Best Fit
        - OS는 사용 가능한 메모리 블록 목록을 검색하여 프로세스의 메모리 요청에 가장 가까운 크기의 블록을 찾는다.
        - 적합한 블록을 찾으면 OS는 블록을 할당될 부분과 나머지 여유 블록으로 나눈다.
    - Next Fit
        - First Fit의 수정된 버전이다.
        - 빈 파티션을 찾기 위해 처음부터 시작하지만, 재 호출 시 처음이 아닌 중단된 부분부터 검색을 시작한다.
        - 로빙 포인터를 사용하며 포인터는 메모리 체인을 따라 이동하여 다음 맞춤을 검색한다.

# 특징

- 메모리 할당은 메모리 관리라는 프로세스를 통해 이루어진다.
    - 메모리는 작은 블록 단위로 할당되는데 이 블록의 크기는 시스템에 따라 다를 수 있다.
    - 주로 1KB, 4KB, 8KB 등의 고정된 크기로 할당된다.
- 메모리 할당은 주로 컴퓨터 하드웨어 작업이지만 운영 체제 및 소프트웨어 응용 프로그램을 통해 관리된다.
- 메모리 할당 프로세스는 물리적 메모리 관리와 가상 메모리 관리에서 매우 유사하다.
- 프로그램과 서비스는 실행될 때 요구 사항에 따라 특정 메모리가 할당된다.
- 프로그램이 작업을 완료하거나 유휴 상태가 되면 메모리가 해제되어 다른 프로그램에 할당되거나 기본 메모리 내에 병합된다.
- 메모리 할당은 프로그램이 실행되는 데 필수적인 단계이며, 메모리를 효과적으로 관리하는 것이 컴퓨터 시스템의 안정성과 성능을 유지하는 데에 있어서 매우 중요하다.

# 작동 방식

- 메모리 할당은 운영 체제를 통해 관리되는 **컴퓨터 하드웨어 작업이다.**
- 메모리 할당 프로세스를 통해 **컴퓨터 메모리의 일부는** 프로그램과 프로세스를 실행하기 위해 따로 확보된다. 할당되는 메모리 양은 프로그램 요구 사항에 따라 다르다.
- 프로그램이나 응용 프로그램의 작업이 완료되면 메모리가 **해제**되어 다른 프로그램에 할당된다.

# 정적 메모리 할당과 동적 메모리 할당

- 동적은 Dynamic이라고 하고, 정적은 Static이라고 한다.
- 동적(Dynamic)할당과 정적(Statics)할당은 **메모리의 할당과 해제를 언제 하느냐**에 따라 구분된다.

### **정적 메모리 할당**

- 컴파일러에 의해 선언된 변수에 할당된다.
- 주소는 연산자의 주소를 사용하여 찾을 수 있으며 포인터에 할당할 수 있다.
- 메모리는 컴파일 시간에 할당된다.
- 컴파일(compile) 단계에서 **메모리가 미리 할당**되고, 함수 혹은 **프로그램이 끝나면 소멸**된다. 즉, **메모리의 크기가 하드코딩** 되어있고 프로그램의 시작 전 해당 메모리의 크기가 결정되어 함수가 종료되거나 프로그램이 종료되면 메모리 공간은 자동으로 반납된다.
- 컴파일 시간은 프로그래밍 코드를 컴퓨터가 이해할 수 있도록 기계어 코드로 변환하는 기간을 말한다.
- 정적할당의 경우 프로그램이 종료되면 자동으로 반납되기 때문에 메모리 누수를 걱정하지 않아도 된다. 컴파일이 되면 메모리 영역이 할당되고 그 이후, 해당 프로그램 및 함수가 종료되면 OS(운영체제)가 자동으로 해당 메모리 공간을 회수해간다. **사용이 끝난 메모리 영역은 자동으로 회수되므로 메모리 영역에 누수가 생기지 않는다**.
- 하지만, 정적할당의 경우 컴파일 단계에서 **stack영역**에 메모리의 크기가 하드코딩 되어 있기 때문에 처음에 메모리의 크기를 많이 할당해 놓으면 해당 프로그램이 끝날 때까지 메모리 영역의 낭비가 생길 수 있다.
    - 즉, 처음에는 10000만큼의 메모리 영역이 필요해서 할당했는데, 뒤로 갈수록 10만큼의 영역만 필요하다고 해도 **메모리의 크기를 조절할 수가 없다**. 컴파일 단계에서 메모리의 크기가 할당되면 **프로그램 실행 도중에 메모리 크기를 변경할 수 없기 때문**이다.
    - 그렇기 때문에 9990만큼의 메모리 영역은 낭비되는 상황이 생길 수 있고, 만약 메모리의 크기가 더 필요한 상황이 와도 추가로 프로그램 실행도중에는 **추가로 할당받을 수가 없다**.
    

### 동적 메모리 할당

- 실행 시 수행되는 메모리 할당
- calloc() 및 malloc() 함수로 동적 메모리 할당을 지원한다. (C)
    - 메모리 공간의 동적 할당에서는 값이 함수에 의해 반환되고 포인터 변수에 할당될 때 이러한 함수를 사용하여 할당된다.
- 프로그램 실행단계에서 기억공간의 크기를 **필요한 크기만큼 할당**하고, **다 쓰면 직접 반납**을 해줘야 한다.
- 동적할당은 **프로그램 실행단계에서 메모리 영역의 크기가 결정**된다. 프로그램 실행 도중 **Heap영역**에 메모리가 할당되며 프로그래머에 의해 **할당(new) 및 소멸(delete)** 된다.
    - 즉, 동적 할당의 경우에는 프로그래머가 **코드를 어떻게 짜느냐에 따라 할당 및 소멸의 유무 및 위치가 달라**진다.
    - 동적으로 메모리를 **할당할 때에는 new연산자를 사용하고, 사용 후 반납시에는 delete연산자**를 사용한다.
- 동적 메모리 할당을 통해 컴퓨터는 메모리 공간을 보다 효율적으로 사용할 수 있다.

| No | 정적 메모리 할당 | 동적 메모리 할당 |
|----| --- | --- |
| 1  | 정적 메모리 할당에서는 프로그램이 실행되거나 함수 호출이 완료될 때까지 변수가 영구적으로 할당된다. 메모리 누수 걱정은 없으나 메모리의 비효율적인 할당가능성 존재 | 동적 메모리 할당에서는 프로그램 단위가 활성화된 경우에만 변수가 할당된다. 사용자 원할 때 메모리영역 할당(new), 반납(delete) 연산자로 수동 반납필요 메모리 누수 가능성 존재 |
| 2  | 정적 메모리 할당은 프로그램 실행 전에 수행된다. | 동적 메모리 할당은 프로그램 실행 중에 수행된다. |
| 3  | 메모리의 정적 할당을 관리하기 위해 Stack을 사용한다. | 메모리의 동적 할당을 관리하기 위해 Heap을 사용한다. |
| 4  | 동적에 비해 비효율적 | 정적에 비해 효율적 |
| 5  | 정적 메모리 할당에는 메모리 재사용성이 없다. | 동적 메모리 할당에는 메모리 재사용성이 있으며 필요하지 않을 때 메모리를 해제할 수 있다. |
| 6  | 정적 메모리 할당에서는 메모리가 할당되면 메모리 크기를 변경할 수 없다. (하드코딩 되어 있음) | 동적 메모리 할당에서는 메모리가 할당될 때 메모리 크기가 변경될 수 있다. |
| 7  | 사용되지 않은 메모리를 재사용할 수 없다. | 메모리를 재사용할 수 있다. 사용자는 필요할 때 더 많은 메모리를 할당할 수 있다. 또한 사용자는 필요할 때 메모리를 해제할 수 있다. |
| 8  | 동적 메모리 할당보다 실행 속도가 빠르다. | 정적 메모리 할당보다 느리다. |
| 9  | 이 메모리는 컴파일 시간에 할당된다. | 이 메모리에서는 런타임에 할당된다. |
| 10 | 이 할당된 메모리에는 프로그램 시작부터 끝까지 남아 있다. | 이렇게 할당된 메모리는 프로그램 도중 언제든지 해제될 수 있다. |
| 11 | 일반적으로 배열에 사용 | 일반적으로 Linked List 에 사용 |
