# PCB(Process Control Block)

![Untitled](PCB(Process_Control_Block)/Untitled.png)

# Definition

- 프로세스의 효율적인 관리를 가능하게 하는 운영 체제의 필수 구성 요소.
- 운영 체제에서 프로세스가 생성되면 해당 프로세스의 정보를 저장하기 위한 데이터 구조가 생성된다. 이를 프로세스 제어 블록(PCB) 이라고 한다.
    - 프로세스 제어 블록(Process Control Block, 줄여서 PCB)은 특정한 프로세스를 관리할 필요가 있는 정보를 포함하는, 운영체제 커널의 자료구조다. PCB는 운영 체제가 프로세스를 표현한 것이라 할 수 있다.
- 운영체제가 프로세스 스케줄링을 위해 프로세스에 관한 모든 정보를 가지고 있는 데이터베이스를 PCB라 한다.
- 프로세스 상태, 프로그램 카운터, 메모리 할당 등 프로세스에 필요한 모든 정보가 포함되어 있다.
- PCB의 주요 목적은 OS가 각 프로세스의 상태를 추적하고 이에 따라 시스템 Resource를 할당하여 여러 프로세스를 효율적으로 관리할 수 있도록 하는 것이다.
- 프로세스가 생성되면 OS는 해당 프로세스에 대한 PCB를 생성하고 프로세스에 필요한 모든 정보를 PCB에 저장한다.
- 그 뒤 Scheduler는 이 정보를 사용하여 우선 순위 및 프로세스가 대기한 시간과 같은 기타 요소를 기반으로 다음에 실행할 프로세스를 결정한다.
- PCB는 필수 프로세스 정보를 저장하고 프로세스 상태 및 진행 상황을 관리하며 효율적이고 공정한 Resource 할당을 보장함으로써 프로세스 실행 및 Resource 할당을 관리한다.
- 운영체제에서 프로세스는 PCB로 나타내어지며, PCB는 프로세스에 대한 중요한 정보를 가지고 있는 자료다. 각 프로세스가 생성될 때마다 고유의 PCB가 생성되고, 프로세스가 완료되면 PCB는 제거된다.
- PCB는 ‘커널 공간’이라고 알려진 운영 체제용으로 특별히 예약된 메모리에 저장된다.
- PCB는 운영 체제가 프로세스를 표현한 것이라 할 수 있다.
- sudo코드
    
    ```cpp
    #include <iostream>
    using namespace std;
    
    struct processControlBlock{
      void * stack; //stack pointer
      pid_t pid; // process id
      struct files_struct *files; //pointer to files open
      // you can add more variables 
      // to store process related information
    
    };
    
    int main() {
      
      processControlBlock instance_process;
      // your code goes here
      return 0;
    }
    ```
    

# PCB의 역할

- 프로세스 제어 블록 의 역할은 각 프로세스에 대한 식별 카드로 발생한다. 운영 체제는 운영 체제가 모든 프로세스의 PCB를 참조할 때까지 어떤 프로세스가 어떤 프로세스인지 알 수 없다.
- PCB는 멀티태스킹과 프로세스 관리에 필수적이다. 프로세스와 관련된 많은 기능과 데이터를 추적하기 위해 운영 체제에서 만들어지고 최신 상태로 유지된다.
- PCB가 수행하는 역할은 크게 다음과 같다.
    
    ### 운영 체제의 프로세스 Scheduling
    
    - OS의 PCB에는 우선순위, 상태, 사용 중인 Resource 등 프로세스에 대한 정보가 포함되어 있다. 운영 체제 Scheduler는 PCB의 정보를 토대로 다음에 실행할 프로세스를 결정한다.
    - 프로세서가 생성되면 OS는 프로세스에 대해 필요한 정보를 저장하는 데 사용되는 PCB를 OS에 할당한다. 그 뒤 Scheduler는 OS에 할당된 PCB로 우선 순위 및 프로세스가 대기한 시간 등의 요소를 기반으로 다음에 실행할 프로세스를 결정한다.
    - OS의 PCB에는 프로세스가 실행 중인지, 대기 중인지, 실행할 준비가 되었는지를 나타내는 프로세스 상태를 비롯한 여러 구성 요소가 포함되어 있다. 또한 프로세스에 의해 실행 중인 현재 명령을 나타내는 프로그램 카운터와 프로세스 스택의 위치를 나타내는 스택 포인터가 포함되어 있다.
    - 프로세스 ID는 운영 체제에서 각 프로세스에 할당한 고유 식별자로, PCB의 중요 구성 요소 중 하나다. 프로세스 ID는 프로세스를 추적하고 운영체제가 프로세스 일시 중지 또는 종료와 같은 작업을 수행할 수 있도록 하는 데 사용된다.
    
    ### 프로세스 실행 및 Resource 할당
    
    - PCB는 프로세스와 운영 체제 사이의 다리 역할을 하며, 프로세스 실행을 관리하고 제어하는 데 필요한 정보를 운영 체제에 제공한다.
    - PCB는 프로세스에 대한 정보를 저장하여 프로세스 실행을 관리한다. 프로세스가 실행 중일 때 운영 체제는 PCB를 참조하여 프로세스 상태 및 진행 상황에 대한 정보를 얻는다.
    - 프로세스가 이벤트나 Resource를 기다리고 있는 경우 운영 체제는 이에 따라 PCB의 프로세스 상태를 업데이트한다.
    - PCB는 프로세스에 대한 Resource할당도 관리한다. 메모리, I/O 장치, CPU 시간 등 프로세스에 할당된 Resource에 대한 정보를 유지 관리한다.
    - PCB는 프로세스에서 사용하는 Resource와 시스템에서 사용 가능한 Resource를 추적하여 Resource가 프로세스 간에 효율적이고 공정하게 할당되도록 한다.
    - 운영 체제가 한 프로세스에서 다른 프로세스로 전환하기로 결정하면 현재 프로세스의 Context를 PCB에 저장하고 PCB에서 다음 프로세스의 Context를 불러온다.
    - 즉, PCB는 중요한 정보를 잃지 않고 중단된 부분부터 프로세스를 재개할 수 있도록 보장한다.
    - 운영 체제는 PCB에 저장된 정보를 사용하여 프로세스 실행 및 Resource할당을 효율적으로 관리할 수 있다. 예를 들어, PCB를 사용하여 실행할 준비가 된 프로세스, I/O 또는 기타 Resource를 기다리는 프로세스, 차단되거나 일시 중단된 프로세스를 확인할 수 있다.
    - 프로세스가 완료되거나 오류로 인해 갑자기 종료되면 그에 따라 PCB를 업데이트해야 한다. 프로세스가 종료되면 해당 PCB는 일반적으로 활성 프로세스 목록에서 제거되고 메모리 및 I/O 장치와 같은 Resource의 할당이 취소된다. PCB는 새로운 프로세스에 재 사용될 수도 있다.
    - PCB는 하위 프로세스 및 공유 Resource에 대한 정보를 유지 관리하여 종료된 프로세스에 의해 생성된 모든 하위 프로세스도 종료되고 공유 Resource가 해제되는지 확인하는 프로세스를 촉진하는 데 도움이 된다.
    
    ### 문맥 교환(Context Switching)
    
    - 문맥 교환은 CPU가 멀티태스킹 환경에서 여러 프로세스 간에 전환할 수 있도록 하는 운영 체제의 중요 개념이다.
    - 문맥 교환이 발생하면 운영 체제는 CPU Register의 내용과 기타 관련 정보를 OS의 PCB에 저장하여 현재 프로세스의 Context를 저장한다. 그 뒤 CPU는 자유롭게 다른 프로세스를 실행할 수 있고 운영 체제는 PCB에서 다음 프로세스의 저장된 Context를 불러온다.
    - PCB에는 프로세스를 관리하는 데 필요한 모든 정보가 포함되어 있으며 프로세스가 일시 중지되거나 선점 되면 운영 체제는 PCB를 업데이트하여 현재 상태와 Resource를 반영한다.
    - PCB를 사용한 문맥 교환은 복잡하고 Resource 집약적인 작업이므로 운영 체제에서 프로세스를 최적화하여 overhead를 최소화하고 시스템 성능을 향상시키는 것이 중요하다.
    - 최신 운영 체제는 정교한 알고리즘과 데이터 구조를 사용하여 PCB를 관리하고 문맥 교환에 필요한 시간과 Resource를 최소화한다.
    
    ### 프로세스 간 Resource 공유
    
    - PCB에는 상태, 우선순위, 소비된 CPU 시간, 메모리 사용량 및 기타 다양한 속성과 같은 프로세스에 대한 중요한 정보가 포함되어 있다. 이 정보는 OS에서 다양한 프로세스에 Resource를 효율적으로 할당하고 Resource가 부족하거나 과도하게 사용되지 않도록 하는 데 사용된다.
    - 프로세스 간 공유되어야 하는 중요한 Resource 중 하나는 CPU로, PCB는 선점 되기 전에 실행 중이던 프로세스의 상태를 저장하여 OS가 해당 상태를 복원하고 CPU 제어권을 다시 얻었을 때 해당 프로세스의 실행을 계속할 수 있도록 하여 공유를 용이하게 한다.
    - PCB가 관리하는 데 도움이 되는 다른 중요한 Resource는 메모리로, PCB에는 프로세스에 할당된 메모리, 가상 메모리 및 기타 메모리 관련 속성에 대한 정보가 포함되어 있다. OS는 이 정보를 사용하여 다양한 프로세스에 메모리를 할당 및 할당 해제하고 분할 오류와 같은 메모리 관련 오류를 방지한다.
    - 그 외에도 PCB는 파일, 네트워크 연결 및 기타 I/O 장치와 같은 입출력 Resource를 관리하는 데도 도움이 된다. PCB에는 프로세스에서 수행하는 I/O 작업 상태에 대한 정보가 포함되어 있어 OS가 Resource를 효율적으로 관리할 수 있게 해준다.

# PCB의 구조

### Process ID

- 사용자가 새 프로세스를 생성하면 운영 체제는 해당 프로세스에 고유 ID, 즉 프로세스 ID를 할당한다. 프로세스 ID는 해당 프로세스를 시스템에 존재하는 다른 프로세스와 구별하는 데 도움을 준다.
- 운영 체제는 처리할 수 있는 최대 프로세스 수에 제한이 있으며, PCB는 N개의 가용 프로세스를 0부터 N-1의 프로세스 ID를 부여함으로서 최대 프로세스 수를 관리한다.
    
    <aside>
    💡 **예시**
    
    process-ID는 0 에서 N-1 까지의 값을 가져온다.
    
    - 첫 번째 프로세스에는 ID 0 이 부여된다.
    - 두 번째 프로세스에는 ID 1 이 부여된다 .
    - N-1 까지 계속된다.
    - 이제 프로세스 (N-1) 이후에 새 프로세스가 생성되면 운영 체제는 ID 0 의 이전 프로세스가 이미 종료되었음을 고려하여 이 새 프로세스에 ID 0을 할당한다. 이는 프로세스 ID를 할당하는 방식 중 하나다.
    </aside>
    
- 일반적으로 오름차순으로 프로세스 ID가 부여되지만, 단일 PCB에 다량의 메모리가 필요하며 한 번에 N개의 프로세스가 허용될 때는 프로세스가 아닌 PCB에 0부터 N - 1까지 번호를 매기는 방식으로 관리된다.

### Process State

- 생성부터 완료까지 프로세스는 다양한 상태를 거친다. 일반적으로 프로세스는 실행 중 5가지 상태 중 하나로 나타낼 수 있다.
    
    ![Untitled](PCB(Process_Control_Block)/Untitled1.png)
    
    - New
        - 운영 체제가 주 메모리에 불러올 준비가 된 프로세스가 포함된다.
    - 준비(Ready)
        - 실행할 준비가 되어 있고 현재 시스템의 주 메모리에 있는 프로세스가 포함되어 있다.
        - 운영 체제는 보조 메모리의 프로세스를 주 메모리(RAM)으로 가져온다.
        - 해당 프로세스는 주 메모리에 존재하며 CPU에 할당되기를 기다린다.
    - 실행 중(Running)
        - 현재 시스템의 CPU에 의해 실행되는 프로세스가 포함된다.
        - 시스템에 총 x개의 CPU가 있는 경우 특정 시간 동안 실행되는 최대 프로세스 수도 x개다.
    - 차단 또는 대기(Waiting(Block))
        - 프로세스는 running 상태에서 block으로 전환되거나 scheduling 알고리즘에 따라 또는 프로세스의 내부 동작으로 인해 대기(waiting) 된다.
            - → 문맥 전환시에 러닝중인 프로세스가 웨이팅, 웨이팅 중이던 프로세스를 러닝시킴.
    - 종료(Termination)
        - 실행이 완료된 프로세스는 종료 상태가 된다.
        - 해당 프로세스(PCB)의 모든 내용도 운영 체제에 의해 삭제된다.
    
    ### Process Priority
    
    - 각 프로세스의 우선 순위를 나타내는 숫자 값이다.
    - 값이 작을수록 해당 프로세스의 우선순위가 높아진다.
    - 우선 순위는 PCB 생성 시 할당되며 해당 프로세스의 수명, 소비된 Resource 등과 같은 여러 요소에 의해 달라질 수 있다.
    - 커널에 가까울수록 보통 우선순위가 낮다
    - 사용자는 프로세스에 외부적으로 우선 순위를 할당할 수도 있다.
        
        ### Process Accounting Information
        
        - 해당 프로세스가 Lifecycle 동안 사용하는 Resource에 대한 정보를 제공한다.
            - ex) CPU 시간 연결 시간 등
        - 시간 제한, 계정 번호, 사용된 CPU 양, 프로세스 번호 등은 모두 PCB 계정 정보의 일부
        - 리소스 정보를 제공
    
    ### Program Counter
    
    - 실행될 프로그램의 다음 명령어를 가리키는 포인터다.
    - PCB의 Program Counter에는 프로세스에서 실행될 다음 명령어의 주소가 포함된다.
    
    ### CPU registers
    
    - CPU가 사용할 수 있는 빠르게 액세스할 수 있는 작은 크기의 위치.
    - 프로세스에서 사용되는 레지스터를 지정한다. 여기에는 누산기, 인덱스 레지스터, 스택 포인터, 범용 레지스터 등이 포함된다.
    - 가상 메모리(RAM)에 저장된다.
    
    ### Context Switching
    
    - CPU를 한 프로세스나 작업에서 다른 프로세스나 작업으로 전환하는 프로세스다.
    - 또한, 추후 프로세스를 복원하고 실행을 재개할 수 있도록 프로세스 상태를 저장하는 프로세스기도 하다.
    - 이를 통해 여러 프로세스가 단일 CPU를 공유할 수 있다. 이는 멀티태스킹 운영 체제의 필수 기능이다.
    - 코드 실행 중 문맥 교환이 발생할 때마다 해당 프로세스의 현재 상태가 CPU Register에 임시로 저장된다.
    - 이는 보조 메모리에서 상태 정보를 검색함으로써 프로세스의 빠른 실행에 도움이 된다.
    
    ### PCB pointer
    
    - 준비 상태에 있는 다음 PCB의 주소가 포함된다.
    - 운영 체제가 상위 프로세스와 하위 프로세스 간의 쉬운 제어 흐름을 계층적으로 유지하는 데 도움이 된다.
    
    ### List of open files
    
    - 해당 프로세스에서 사용되는 모든 파일에 대한 정보가 포함되어 있다.
    - 운영 체제가 프로세스 종료 상태에서 열려 있는 모든 파일을 닫는 데 도움이 된다.
    
    ### Process I/O information
    
    - 실행 중에 해당 프로세스에 필요한 모든 I/O 장치 목록이 언급(mention)된다.
    - 프로세스에서 사용하는 I/O 장치 목록, 파일 목록 등이 포함

# 4. 저장방식

- PCB는 그림과 같이 LinkedList 형태로 메모리에 저장된다 .

![https://scaler.com/topics/images/how-pcbs-are-stored.webp](https://scaler.com/topics/images/how-pcbs-are-stored.webp)

- 운영 체제는 **프로세스 테이블을** 사용하여 메모리에 있는 PCB를 찾는다.

<aside>
💡 **프로세스 테이블**

- **프로세스 테이블은** 프로세스 ID 와 메모리의 해당 PCB에 대한 참조를 포함하는 테이블이다 . 프로세스 테이블을 실행 중인 모든 프로세스 목록이 포함된 사전으로 시각화할 수 있다.
</aside>

![Untitled](PCB(Process_Control_Block)/Untitled2.png)

- 따라서 프로세스 간에 컨텍스트 전환이 발생할 때마다 운영 체제는 해당 프로세스 ID의 도움으로 PCB 에 대한 참조를 찾기 위해 프로세스 테이블을 참조한다.
- 운영체제는 빠르게 PCB 에 접근하기 위해서 **프로세스 테이블**을 사용해 각 프로세스의 PCB 를 관리하고 PCB 는 **연결 리스트 방식**으로 관리된다. 프로세스가 생성, 삭제될 때 PCB 의 삽입 삭제가 용이하다.

# 5. 요약

- 프로세스 제어 블록(PCB)은 각 프로세스의 정보를 저장하기 위해 운영 체제에서 유지 관리하는 데이터 구조이다.
- PCB의 역할은 운영 체제가 프로세스를 쉽게 구분할 수 있도록 각 프로세스에 ID를 부여하는 것이다.
- PCB에는 프로세스 ID, 프로세스 우선순위, 프로세스 상태, 계정 정보, 열린 파일 목록 등과 같은 필드가 포함되어 있다.
- PCB는 메모리에 LinkedList 형태로 저장된다.
- **프로세스 테이블에는** 현재 시스템에서 실행 중인 모든 프로세스에 대한 참조가 포함되어 있다. 따라서 OS가 컨텍스트 전환을 수행할 때마다 필요한 프로세스에 대한 프로세스 테이블을 참조한다.